@use 'sass:math'

@font-face
  font-family: Stardew Valley Stonks
  src: url("/public/Stardew Valley Stonks.otf")

$phi: math.div(1 + math.sqrt(5), 2)

@function ui-img($file)
  @return url("/public/img/UI/#{$file}.png")

:root
  font: var(--font-size, 100%) / 1.25 Stardew Valley Stonks, Nunito, sans

body
  display: flex
  flex-direction: column

  min-height: 100vh
  max-height: 100vh

  background-image: ui-img("Gradient")
  background-size: contain
  background-repeat: repeat-x
  margin: 0

  & > span // noscript
    text-align: center
    margin-top: 1rem

ul
  list-style: none
  padding: 0
  margin: 0

%colon
  &::after
    font-weight: 600
    content: ":"

dl
  display: grid
  grid-template-columns: auto auto
  justify-content: start
  gap: 0 0.5em

dt
  @extend %colon

dd
  margin: 0

%button-unstyled
  padding: 0
  background: none
  outline: none
  box-shadow: none
  border: none

%focus-outline
  outline: var(--eighth-border) solid #d83700
  outline-offset: var(--eighth-border)

:focus
  @extend %focus-outline

%hover-brightness
  filter: brightness(1.15)

%hover-scale
  transform: scale(1.1)

input
  font-family: inherit
  font-size: inherit

.file
  &-dropzone
    background: lightgray
    height: 5rem

  &-input
    display: inline-block
    @extend button

    & > input
      @extend %hidden-input

    &:focus-within
      @extend %focus-outline


input[type=range]
  $scale: 3
  $height: 6px * $scale

  -webkit-appearance: none
  background: transparent
  margin: 0
  cursor: pointer
  width: calc(max(100px, 10rem))
  height: $height

  &:hover
    @extend %hover-brightness

  // css needs to be repeated/inlined for some reason
  // and cannot be reused across webkit and mozilla
  @mixin thumb
    box-shadow: none
    border: none
    border-radius: 0
    width: 10px * $scale
    height: $height
    image-rendering: pixelated
    background: ui-img("Range Thumb")
    background-size: contain
    background-repeat: no-repeat
    background-position: center

  &::-webkit-slider-thumb
    -webkit-appearance: none
    @include thumb

  &::-moz-range-thumb
    @include thumb

  @mixin track
    height: $height
    image-rendering: pixelated
    border-image-source: ui-img("Range Track")
    border-image-slice: 2 fill
    border-image-width: 2px * $scale

  &::-webkit-slider-runnable-track
    @include track

  &::-moz-range-track
    @include track

.border-box
  border-image-source: ui-img("Border Box")
  border-image-slice: 12 fill
  border-image-width: 1rem
  border-image-outset: 1rem
  margin: 1rem

main
  flex-grow: 1
  display: flex
  flex-flow: row
  overflow: hidden

  & > section
    min-width: min-content
    flex-basis: 0
    flex-grow: 1
    display: flex
    flex-direction: column
    overflow: hidden

    & > [role=tabpanel]
      @extend .border-box
      flex-grow: 1
      display: flex
      flex-direction: column
      overflow: auto


.graph
  flex-grow: 1
  overflow: hidden

  &-controls
    display: flex
    justify-content: center
    align-items: center

.recharts-wrapper
  overflow: hidden

.recharts-tooltip-wrapper:focus
  outline: none

.recharts-bar-rectangle
  cursor: pointer

.pair-image
  cursor: pointer

.pair-select
  cursor: pointer
  fill: transparent

.summary

  &-controls
    display: flex
    flex-direction: column
    align-items: center

    & > div
      display: flex
      width: 100%
      justify-content: center
      align-items: center

.settings-group
  display: flex
  flex-direction: column

@media (max-aspect-ratio: 1)
  body
    max-height: unset

  main
    display: block

  .graph
    height: 50vh


img
  user-select: none

$arrow-length: 1em

%arrow
  content: ""
  display: inline-block
  background-size: contain
  background-repeat: no-repeat
  width: $arrow-length
  height: $arrow-length

%arrow-right
  background-image: ui-img("Arrow Right")

%arrow-up
  background-image: ui-img("Arrow Up")

%arrow-down
  background-image: ui-img("Arrow Down")

details
  & > div
    opacity: 0
    transform: scaleY(0)

  // details[open] > div
  // and
  // details.open > div
  // are broken -> only gets triggered on first open?
  & > div.open
    opacity: 1
    transform: scaleY(1)
    transform-origin: top
    transition: opacity 0.5s, transform 0.5s

  & > summary
    list-style: none
    cursor: pointer
    font-size: 1.5rem
    padding: 0.25em

    &::before
      @extend %arrow
      @extend %arrow-right
      margin-right: 0.5em

    &:hover::before
      @extend %hover-scale

  &[open] > summary::before
    @extend %arrow-down


%hidden-input
  transform: scale(0)
  opacity: 0
  position: absolute

.checkbox
  cursor: pointer

  & > input
    @extend %hidden-input

  & > input + img
    content: ui-img("Checkbox")
    vertical-align: text-bottom
    width: 1.5em
    height: 1.5em

    &:not(:last-child)
      margin-right: 0.5em

  & > input:checked + img
    content: ui-img("Checkedbox")

  & > input:focus + img
    @extend %focus-outline

  &:hover > input + img
    @extend %hover-scale

.label-hidden
  @extend %colon
  font-size: 0

.label-text
  @extend %colon
  margin-right: 0.5em

.profession
  display: block
  width: 100%
  height: 2.5rem

  & > input
    @extend %hidden-input

  & > input:checked + *
    color: green

  & > input:focus + *
    @extend %focus-outline

  &:hover
    background: white

.professions
  display: flex
  justify-content: center
  align-items: center
  flex-wrap: wrap

  & > div
    display: flex
    flex-direction: column
    width: 50%
    align-items: center

.skill
  display: flex
  flex-direction: column

  & > span:first-child
    font-size: 2rem
    text-align: center

  &-level
    display: flex
    flex-direction: column


.calendar
  &-season
    padding: 0.5em 1em
    min-width: min-content

  &-header
    display: flex
    justify-content: center
    align-items: center
    font-size: 2rem
    margin-bottom: 0.25em

  &-days
    display: grid
    grid-template-columns: repeat(7, minmax(4rem, 1fr))
    grid-auto-rows: 1fr
    gap: var(--eighth-border)
    border: var(--eighth-border) solid black

    & > div
      position: relative
      display: flex
      aspect-ratio: 1
      align-items: center
      justify-content: center
      outline: var(--eighth-border) solid black
      padding: 10%
      $counter-offset: 4%

      & > img
        width: 50%
        height: unset

      &:nth-child(28n + 1)
        counter-reset: day

      &::before
        counter-increment: day
        content: counter(day)
        position: absolute
        top: $counter-offset
        left: calc(#{$counter-offset} + 0.125rem)


.input-box
  background: none
  image-rendering: pixelated
  border-image-source: ui-img("Input Box")
  border-image-slice: 3 3 2 2 fill
  border-image-width: 0.5rem
  padding: 0.5rem

  &::-webkit-outer-spin-button, &::-webkit-inner-spin-button
    -webkit-appearance: none
    margin: 0

  -moz-appearance: textfield

  &:hover
    @extend %hover-brightness


.select
  $padding: 0.5rem
  $background: #f9ba66
  $background-hover: #f5deb3
  --border: #5b2b2a solid var(--sixth-border)

  display: inline-flex
  cursor: pointer

  &:focus-within
    @extend %focus-outline

  &[aria-expanded=true]:focus-within
    outline: none

  &[aria-expanded=false]:hover > div > .select-control
    background-color: $background-hover

  & > div
    position: relative

  & > img
    content: ui-img("Select Spinner")
    height: 1rem + 2 * $padding
    border: var(--border)
    border-left: none

  &-control
    position: relative
    height: 100%
    box-sizing: border-box
    border: var(--border)
    background-color: $background
    padding: 0 $padding

    display: flex
    align-items: center

    & > input[type=search]
      outline: none
      background: transparent
      border: none
      position: absolute
      padding: 0
      width: calc(100% - 2 * #{$padding})
      height: 100%

      &:not(:placeholder-shown) + *
        visibility: hidden

    & > input[inputmode=none]
      @extend %hidden-input

    & > span
      margin-top: 0.125rem

    & span
      display: inline
      overflow: hidden
      text-overflow: ellipsis
      white-space: nowrap

  &-list
    max-height: 50vh
    position: absolute
    left: 0
    top: 100%
    width: 100%
    z-index: 2
    border: var(--border)
    border-top: none
    background-color: $background
    box-sizing: border-box
    overflow: auto

    & > li
      padding: $padding

      &.select-empty
        text-align: center
        padding: 1.5 * $padding

      &[aria-selected=true]
        background-color: $background-hover

%season
  height: 1.25em

@mixin season($name)
  .#{to-lower-case($name)}
    @extend %season
    content: url("/public/img/Seasons/#{$name}.png")

@each $season in Spring Summer Fall Winter
  @include season($season)

.seasons
  display: grid
  grid-template-columns: repeat(4, 1fr)

.icon
  width: 1.5em
  height: 1.5em

  &-processor
    width: 1.25em

  &-text
    display: inline-block

    & > :first-child
      vertical-align: text-bottom
      margin-right: 0.25em

@mixin icon-img($name, $folder)
  .#{to-lower-case($name)}
    @extend .icon
    content: url("/public/img/#{$folder}/#{$name}.png")

@each $product in Jam Pickles Wine Juice
  @include icon-img($product, "Products")

@each $profession in Tiller Artisan Agriculturist Gatherer Botanist
  @include icon-img($profession, "Skills")

%skill
  width: 1.25em
  height: 1.25em

@each $skill in Farming Foraging
  .#{to-lower-case($skill)}
    @extend %skill
    content: url("/public/img/Skills/#{$skill}.png")

@mixin quality($quality, $color)
  .#{to-lower-case(#{$quality})}
    --color: #{$color}
    --img: url("/public/img/Qualities/#{$quality}.png")

@include quality(Iridium, purple)
@include quality(Gold, gold)
@include quality(Silver, silver)
@include quality(Normal, white)

%square-button
  @extend %button-unstyled
  background-size: contain

  &:hover
    @extend %hover-scale

@mixin square-button($name, $width)
  .#{to-lower-case($name)}
    @extend %square-button
    width: $width
    height: $width
    background-image: ui-img("#{$name}")

@include square-button(Ok, 2.5rem)
@include square-button(Cancel, 2.5rem)
@include square-button(Edit, 1.5rem)


.back
  @extend %button-unstyled
  font-size: 1.5rem
  padding: 0.25em 0.25em 0.125em 0.25em

  &::before
    @extend %arrow
    @extend %arrow-left
    margin-right: 0.5em

  &:hover::before
    @extend %hover-scale


.crop-qualities
  $transition: flex-grow 0.75s

  width: 100%

  &-bars
    height: 1rem
    display: flex

    & > div
      transition: $transition
      background-color: var(--color)

  &-probs
    height: 1rem
    display: flex

    & > div
      transition: $transition
      flex-basis: min-content
      text-align: center
      color: var(--color)

.quality
  display: inline-block
  position: relative
  @extend .icon

  & > img:last-child
    content: var(--img)
    position: absolute
    left: 0
    bottom: 0
    width: 50%
    height: 50%


.disabled
  opacity: 0.5

footer
  background-color: white
  display: flex
  align-items: center
  justify-content: space-evenly
  text-align: center

dialog
  min-width: 15rem
  max-width: calc(min(80ch, 40vw))

button
  font-family: inherit
  font-size: inherit
  cursor: pointer

.button
  background: none
  image-rendering: pixelated
  border-image-source: ui-img("Button")
  border-image-slice: 2 fill
  border-image-width: 0.25em
  padding: 0.5em

  &:hover
    @extend %hover-brightness

table, tr
  // ignored by browser, but needed for td and th 100% height
  height: 1px

th, td
  // allows inner divs to take up full height
  height: 100%
  vertical-align: middle

th, th > button
  font-weight: 500

tr
  &:nth-child(odd)
    background: #f9ba66

  &:nth-child(even)
    background: scale-color(#f9ba66, $lightness: 25%)

tbody th
  text-align: left

th.colunm-sort
  & > button
    @extend %button-unstyled
    width: 100%
    height: 100%
    display: flex
    align-items: center
    justify-content: center

  & > button::after
    @extend %arrow
    flex-shrink: 0
    margin-left: 0.25em

  &[aria-sort=ascending] > button::after
    @extend %arrow-up

  &[aria-sort=descending] > button::after
    @extend %arrow-down

  & > button:focus
    @extend %focus-outline

  &:not([aria-sort]) > button:hover::after
    @extend %arrow-up
    opacity: 0.5

.collapse-arrow
  @extend %button-unstyled
  height: 1.5em
  width: $arrow-length
  margin-left: 0.125em
  display: flex
  align-items: center
  justify-content: center

  &::before
    @extend %arrow

  &[aria-pressed=false]::before
    @extend %arrow-right

  &[aria-pressed=true]::before
    @extend %arrow-down

  &:focus::before
    @extend %focus-outline
    outline-offset: 0.25em

  &:hover::before
    @extend %hover-scale

tr
  &.expanded
    border-bottom: black dashed var(--eighth-border)

  &.collapsed ~ tr
    visibility: collapse
    // until safari and other browsers stop treating visibility: collapse as visibility: hidden
    // this is necessary to mimic visibility: collapse
    // unfortunately, this will cause the table to recompute its layout even for well behaved browsers
    position: absolute

.summary-table
  --border: black solid var(--eighth-border)

  border-collapse: collapse

  & > *
    border: var(--border)

  // empty tbody messes up borders on firefox?
  & > tbody:empty
    display: none

  // all cells
  & tr > *
    padding: 0.5em

    &:empty
      padding: 0

    // last 4 columns
    &:nth-last-child(-n+4)
      text-align: right

    // profit/xp column
    &:nth-last-child(2)
      min-width: 5em

  // row header column in thead and tfoot
  & th:nth-child(-n+2)
    text-align: center

  // row header column in tbody
  & > tbody th:nth-child(-n+2)
    text-align: left

.input-items
  & > summary
    font-size: 1rem
    padding: 0

  & > ul
    margin-left: $arrow-length + 0.5em

#settings table
  --border: black solid var(--eighth-border)

  border-collapse: separate
  border-spacing: 0
  border: var(--border)
  border-top: none

  & th
    padding: 0.5em 0.25em

  & tbody th > *
    min-width: max-content

  & td
    padding: 0.5em 0.25em

  & tr > :first-child
    padding-left: 0.5em

  & tr > :last-child
    padding-right: 0.5em

  & > thead
    position: sticky
    top: 0
    z-index: 1

    & th
      border-top: var(--border)
      border-bottom: var(--border)

      &.disabled
        opacity: 1

        & > *
          @extend .disabled
